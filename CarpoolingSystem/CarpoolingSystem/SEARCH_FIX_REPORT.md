# ğŸ”§ æ™ºèƒ½æœç´¢åŠŸèƒ½ä¿®å¤æŠ¥å‘Š

## ğŸ“‹ é—®é¢˜æ€»ç»“

**åŸå§‹é—®é¢˜ï¼š**
- æ™ºèƒ½æœç´¢é¡µé¢ç‚¹å‡»"æœç´¢è¡Œç¨‹"æŒ‰é’®æ²¡æœ‰ååº”
- ContentView.swift æŠ¥é”™ï¼šæ— æ³•æ‰¾åˆ° `AdvancedRide` å’Œ `RideDataStore` ç±»å‹

**æ ¹æœ¬åŸå› ï¼š**
1. `AdvancedSearchView` ä½¿ç”¨äº†æ—§çš„æ•°æ®æ¨¡å‹ï¼ˆ`Ride` å’Œ `RideService`ï¼‰
2. åº”ç”¨å…¥å£æ²¡æœ‰æ³¨å…¥æ–°çš„ `RideDataStore` ç¯å¢ƒå¯¹è±¡
3. `ContentView.swift` ç¼ºå°‘ `import SwiftUI` è¯­å¥
4. ç¼ºå°‘ `RideTrackingView` å®æ—¶è¿½è¸ªè§†å›¾

---

## âœ… å·²ä¿®å¤çš„é—®é¢˜

### 1. æ›´æ–°åº”ç”¨å…¥å£æ–‡ä»¶ (`CarpoolingSystemApp.swift`)

**ä¿®æ”¹å‰ï¼š**
```swift
@StateObject var authManager = AuthManager.shared
@StateObject var rideService = RideService()

var body: some Scene {
    WindowGroup {
        ContentView()
            .environmentObject(authManager)
            .environmentObject(rideService)
    }
}
```

**ä¿®æ”¹åï¼š**
```swift
@StateObject var authManager = AuthManager.shared
@StateObject var rideService = RideService()  // ä¿ç•™æ—§æœåŠ¡
@StateObject var dataStore = RideDataStore()  // æ–°å¢ï¼šé«˜çº§æ•°æ®å­˜å‚¨

var body: some Scene {
    WindowGroup {
        ContentView()
            .environmentObject(authManager)
            .environmentObject(rideService)
            .environmentObject(dataStore)  // æ³¨å…¥æ–°çš„ç¯å¢ƒå¯¹è±¡
    }
}
```

### 2. ä¿®å¤ ContentView.swift

**é—®é¢˜ï¼š** æ–‡ä»¶é¡¶éƒ¨ç¼ºå°‘ `import SwiftUI`

**å·²æ·»åŠ ï¼š**
```swift
import SwiftUI

// MARK: - Main Entry View
struct ContentView: View {
    ...
}
```

### 3. é‡å†™ AdvancedSearchView

**æ ¸å¿ƒæ”¹è¿›ï¼š**
- âœ… ä½¿ç”¨ `RideDataStore` æ›¿ä»£ `RideService`
- âœ… æœç´¢ç»“æœç±»å‹ä» `[Ride]` æ”¹ä¸º `[AdvancedRide]`
- âœ… ä½¿ç”¨ `dataStore.searchRides(userRole: .passenger)` è·å–å¸æœºå‘è½¦
- âœ… æœç´¢ç»“æœç›´æ¥æ˜¾ç¤ºåœ¨åŒä¸€é¡µé¢ï¼ˆä¸å†è·³è½¬ï¼‰
- âœ… æ·»åŠ è°ƒè¯•æ—¥å¿—ï¼Œæ–¹ä¾¿æ’æŸ¥é—®é¢˜

**æœç´¢é€»è¾‘ï¼š**
```swift
func performSearch() {
    // 1. è·å–æ‰€æœ‰å¸æœºå‘å¸ƒçš„è¡Œç¨‹
    var results = dataStore.searchRides(userRole: .passenger)
    
    // 2. æŒ‰å‡ºå‘åœ°è¿‡æ»¤ï¼ˆæ¨¡ç³ŠåŒ¹é…ï¼‰
    if !originInput.isEmpty {
        results = results.filter { 
            $0.startLocation.localizedCaseInsensitiveContains(originInput) 
        }
    }
    
    // 3. æŒ‰ç›®çš„åœ°è¿‡æ»¤ï¼ˆæ¨¡ç³ŠåŒ¹é…ï¼‰
    if !destinationInput.isEmpty {
        results = results.filter { 
            $0.endLocation.localizedCaseInsensitiveContains(destinationInput) 
        }
    }
    
    // 4. æŒ‰æ—¶é—´èŒƒå›´è¿‡æ»¤ï¼ˆÂ±30åˆ†é’Ÿï¼‰
    results = results.filter { ride in
        let timeDifference = abs(ride.departureTime.timeIntervalSince(selectedTime))
        return timeDifference <= 1800
    }
    
    // 5. è¿‡æ»¤å·²è¿‡æœŸå’Œå·²å®Œæˆçš„è¡Œç¨‹
    results = results.filter { 
        $0.departureTime > Date() && $0.status != .completed 
    }
    
    // 6. æŒ‰æ—¶é—´æ’åº
    searchResults = results.sorted { $0.departureTime < $1.departureTime }
    hasSearched = true
}
```

### 4. åˆ›å»º RideTrackingView.swift

**æ–°å¢æ–‡ä»¶ï¼š** `RideTrackingView.swift`

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- âœ… ä½¿ç”¨ MapKit æ˜¾ç¤ºå®æ—¶åœ°å›¾
- âœ… æ”¯æŒåŒè§†è§’ï¼ˆä¹˜å®¢çœ‹å¸æœºï¼Œå¸æœºçœ‹ä¹˜å®¢ï¼‰
- âœ… æ˜¾ç¤º ETAï¼ˆé¢„è®¡åˆ°è¾¾æ—¶é—´ï¼‰
- âœ… åœ°å›¾æ ‡æ³¨ï¼ˆå¸æœºä½ç½®ã€ä¹˜å®¢ä½ç½®ã€ç›®çš„åœ°ï¼‰
- âœ… å®æ—¶ä¿¡æ¯å¡ç‰‡

**è§†è§’åŒºåˆ«ï¼š**
```swift
enum ViewerRole {
    case passenger  // ä¹˜å®¢ï¼šæŸ¥çœ‹å¸æœºä½ç½® + ETA
    case driver     // å¸æœºï¼šæŸ¥çœ‹æ‰€æœ‰ä¹˜å®¢ä½ç½®
}
```

### 5. åˆ é™¤åºŸå¼ƒçš„æ—§è§†å›¾

å·²åˆ é™¤ä»¥ä¸‹ä½¿ç”¨æ—§æ•°æ®æ¨¡å‹çš„è§†å›¾ï¼š
- âŒ `AdvancedSearchResultsView`ï¼ˆä¸å†éœ€è¦å•ç‹¬ç»“æœé¡µï¼‰
- âŒ `AdvancedRideCard`ï¼ˆä½¿ç”¨ `PassengerRideCard` æ›¿ä»£ï¼‰
- âŒ `AdvancedRideDetailView`ï¼ˆä½¿ç”¨ `PassengerRideDetailView` æ›¿ä»£ï¼‰

---

## ğŸ¯ æ–°çš„æ•°æ®æµæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CarpoolingSystemApp.swift         â”‚
â”‚   â”œâ”€ AuthManager (å·²æœ‰)             â”‚
â”‚   â”œâ”€ RideService (æ—§ç³»ç»Ÿ)           â”‚
â”‚   â””â”€ RideDataStore (æ–°ç³»ç»Ÿ) âœ¨      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”œâ”€â”€> ContentView.swift
                 â”‚    â”œâ”€ LoginView (ä½¿ç”¨æ—§ç³»ç»Ÿ)
                 â”‚    â””â”€ MainTabView
                 â”‚         â”œâ”€ SimpleHomeView (æ—§)
                 â”‚         â”œâ”€ AdvancedSearchView (æ–°) âœ…
                 â”‚         â”œâ”€ SimplePublishView (æ—§)
                 â”‚         â””â”€ ProfileView
                 â”‚
                 â””â”€â”€> æ–°çš„é«˜çº§åŠŸèƒ½
                      â”œâ”€ PassengerView.swift
                      â”‚   â”œâ”€ PassengerRideListView âœ…
                      â”‚   â””â”€ PassengerRideDetailView âœ…
                      â”‚
                      â”œâ”€ DriverView.swift (å¾…å®ç°)
                      â”‚
                      â””â”€ RideTrackingView.swift âœ…
```

---

## ğŸ§ª æµ‹è¯•æ¸…å•

### æ™ºèƒ½æœç´¢åŠŸèƒ½æµ‹è¯•

1. **åŸºç¡€æœç´¢**
   - [ ] è¾“å…¥å‡ºå‘åœ°ï¼Œç‚¹å‡»æœç´¢ï¼ŒæŸ¥çœ‹ç»“æœ
   - [ ] è¾“å…¥ç›®çš„åœ°ï¼Œç‚¹å‡»æœç´¢ï¼ŒæŸ¥çœ‹ç»“æœ
   - [ ] åŒæ—¶è¾“å…¥å‡ºå‘åœ°å’Œç›®çš„åœ°
   - [ ] è°ƒæ•´å‡ºå‘æ—¶é—´ï¼ˆåº”åŒ¹é…Â±30åˆ†é’Ÿå†…çš„è¡Œç¨‹ï¼‰

2. **ç©ºçŠ¶æ€**
   - [ ] ä¸è¾“å…¥ä»»ä½•æ¡ä»¶ï¼Œæœç´¢æŒ‰é’®åº”ç½®ç°
   - [ ] æœç´¢æ— ç»“æœæ—¶ï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€æç¤º

3. **è°ƒè¯•æ—¥å¿—**
   æ‰“å¼€ Xcode æ§åˆ¶å°ï¼Œæœç´¢æ—¶åº”çœ‹åˆ°ï¼š
   ```
   ğŸ” å¼€å§‹æœç´¢ - æ€»è¡Œç¨‹æ•°: X
   ğŸ” å¸æœºå‘è½¦è¡Œç¨‹æ•°: Y
   ğŸ” å‡ºå‘åœ°ç­›é€‰å: Z ä¸ªè¡Œç¨‹
   ğŸ” ç›®çš„åœ°ç­›é€‰å: W ä¸ªè¡Œç¨‹
   ğŸ” æ—¶é—´ç­›é€‰å: V ä¸ªè¡Œç¨‹
   ğŸ” æœ€ç»ˆç»“æœ: U ä¸ªè¡Œç¨‹
   ```

4. **ç»“æœé¡µé¢**
   - [ ] ç‚¹å‡»è¡Œç¨‹å¡ç‰‡ï¼Œè¿›å…¥è¯¦æƒ…é¡µ
   - [ ] è¯¦æƒ…é¡µæ˜¾ç¤º"ç¡®è®¤åŠ å…¥"æŒ‰é’®
   - [ ] åŠ å…¥è¡Œç¨‹åï¼ŒçŠ¶æ€æ˜¾ç¤º"å·²åŠ å…¥"

### å®æ—¶è¿½è¸ªåŠŸèƒ½æµ‹è¯•

1. **ä¹˜å®¢è§†è§’**
   - [ ] åœ¨è¡Œç¨‹è¯¦æƒ…é¡µç‚¹å‡»"æŸ¥çœ‹å¸æœºä½ç½®"
   - [ ] åœ°å›¾æ˜¾ç¤ºå¸æœºæ ‡è®°ï¼ˆè“è‰²æ±½è½¦å›¾æ ‡ï¼‰
   - [ ] æ˜¾ç¤ºé¢„è®¡åˆ°è¾¾æ—¶é—´
   - [ ] æ˜¾ç¤ºç›®çš„åœ°æ ‡è®°ï¼ˆçº¢è‰²å›¾é’‰ï¼‰

2. **å¸æœºè§†è§’**ï¼ˆå¾…å®ç° DriverView åæµ‹è¯•ï¼‰
   - [ ] ç‚¹å‡»"å¼€å§‹è¿½è¸ªä¹˜å®¢"
   - [ ] åœ°å›¾æ˜¾ç¤ºæ‰€æœ‰ä¹˜å®¢æ ‡è®°ï¼ˆæ©™è‰²äººç‰©å›¾æ ‡ï¼‰
   - [ ] æ˜¾ç¤ºå½“å‰ä¹˜å®¢æ•°é‡

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **åœ°å›¾æ€§èƒ½**
   - å½“å‰ä½¿ç”¨ SwiftUI åŸç”Ÿ `Map`ï¼Œæ€§èƒ½è‰¯å¥½
   - å¦‚éœ€æ›´é«˜çº§åŠŸèƒ½ï¼Œå¯è€ƒè™‘ä½¿ç”¨ `MapKit` çš„ `MKMapView`

2. **å®æ—¶æ›´æ–°**
   - å½“å‰æ˜¯æ¨¡æ‹Ÿæ•°æ®ï¼ŒçœŸå®ç¯å¢ƒéœ€è¦ï¼š
     - WebSocket æˆ– Firebase Realtime Database å®æ—¶ä½ç½®
     - æ¯ 5-10 ç§’æ›´æ–°ä¸€æ¬¡ä½ç½®
     - åå°ä½ç½®è¿½è¸ªæƒé™

3. **å†…å­˜ç®¡ç†**
   - `RideDataStore` å’Œ `RideService` åŒæ—¶å­˜åœ¨ï¼ŒåæœŸåº”ç»Ÿä¸€ä¸ºä¸€ä¸ª
   - å»ºè®®é€æ­¥è¿ç§»æ‰€æœ‰æ—§åŠŸèƒ½åˆ°æ–°æ¶æ„

---

## ğŸš€ ä¸‹ä¸€æ­¥å·¥ä½œ

1. **å®ç° DriverView**
   - å¸æœºç«¯å‘å¸ƒè¡Œç¨‹ç•Œé¢
   - å¸æœºç«¯æŸ¥çœ‹å­¦ç”Ÿæ±‚è½¦åˆ—è¡¨
   - å¸æœºæ¥å•åŠŸèƒ½

2. **ç»Ÿä¸€æ•°æ®å±‚**
   - å°†æ—§çš„ `RideService` åŠŸèƒ½è¿ç§»åˆ° `RideDataStore`
   - åˆ é™¤é‡å¤ä»£ç 

3. **çœŸå®ä½ç½®è¿½è¸ª**
   - é›†æˆ CoreLocation
   - å®ç°åå°ä½ç½®æ›´æ–°
   - è¿æ¥ Firebase å®æ—¶æ•°æ®åº“

4. **æ¨é€é€šçŸ¥**
   - ä¹˜å®¢åŠ å…¥æ—¶é€šçŸ¥å¸æœº
   - å¸æœºæ¥å•æ—¶é€šçŸ¥ä¹˜å®¢
   - è¡Œç¨‹å¼€å§‹å‰æé†’

---

## ğŸ“ æ–‡ä»¶å˜æ›´æ¸…å•

### ä¿®æ”¹çš„æ–‡ä»¶
1. âœ… `CarpoolingSystemApp.swift` - æ·»åŠ  RideDataStore æ³¨å…¥
2. âœ… `ContentView.swift` - æ·»åŠ  importï¼Œæ›´æ–° AdvancedSearchView
3. âœ… `PassengerView.swift` - å·²å­˜åœ¨ï¼Œä½¿ç”¨æ–°æ•°æ®æ¨¡å‹

### æ–°å¢çš„æ–‡ä»¶
4. âœ… `RideTrackingView.swift` - å®æ—¶ä½ç½®è¿½è¸ªè§†å›¾

### æ— éœ€ä¿®æ”¹çš„æ–‡ä»¶
- âœ… `RideModels.swift` - æ•°æ®æ¨¡å‹å®šä¹‰
- âœ… `RideDataStore.swift` - çŠ¶æ€ç®¡ç†é€»è¾‘
- âœ… `AuthManager.swift` - è®¤è¯ç®¡ç†
- âœ… `RideService.swift` - æ—§ç³»ç»ŸæœåŠ¡

---

## ğŸ’¡ å¸¸è§é—®é¢˜ FAQ

**Q1: ä¸ºä»€ä¹ˆæœç´¢åæ²¡æœ‰ç»“æœï¼Ÿ**

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. æ˜¯å¦æœ‰æµ‹è¯•æ•°æ®ï¼ŸæŸ¥çœ‹æ§åˆ¶å°æ—¥å¿— `ğŸ” æ€»è¡Œç¨‹æ•°`
2. æµ‹è¯•æ•°æ®çš„å‡ºå‘æ—¶é—´æ˜¯å¦åœ¨ä½ é€‰æ‹©çš„æ—¶é—´Â±30åˆ†é’Ÿå†…ï¼Ÿ
3. æµ‹è¯•æ•°æ®æ˜¯å¦æ˜¯ `driverOffer` ç±»å‹ï¼Ÿï¼ˆä¹˜å®¢åªèƒ½æœç´¢å¸æœºå‘è½¦ï¼‰

**Q2: ç‚¹å‡»æœç´¢æŒ‰é’®æ²¡ååº”ï¼Ÿ**

A: ç¡®ä¿ï¼š
1. è‡³å°‘è¾“å…¥äº†å‡ºå‘åœ°æˆ–ç›®çš„åœ°ä¹‹ä¸€
2. æŸ¥çœ‹ Xcode æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
3. ç¡®è®¤ `RideDataStore` å·²æ­£ç¡®æ³¨å…¥ç¯å¢ƒå¯¹è±¡

**Q3: ç±»å‹æ‰¾ä¸åˆ°é”™è¯¯ï¼Ÿ**

A: 
- ç¡®ä¿æ‰€æœ‰æ–‡ä»¶éƒ½æœ‰ `import SwiftUI`
- æ£€æŸ¥ `CarpoolingSystemApp.swift` æ˜¯å¦æ³¨å…¥äº† `.environmentObject(dataStore)`
- æ¸…ç†æ„å»ºæ–‡ä»¶å¤¹ï¼šProduct > Clean Build Folder (Shift + Cmd + K)

**Q4: åœ°å›¾ä¸æ˜¾ç¤ºï¼Ÿ**

A:
- ç¡®ä¿æµ‹è¯•æ•°æ®ä¸­æœ‰ `driverCurrentLocation` å’Œ `destinationLocation`
- æ£€æŸ¥æ¨¡æ‹Ÿå™¨æ˜¯å¦å¼€å¯ä½ç½®æƒé™
- æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰ MapKit ç›¸å…³é”™è¯¯

---

## âœ¨ æ€»ç»“

æœ¬æ¬¡ä¿®å¤å®Œæˆäº†ä»¥ä¸‹ç›®æ ‡ï¼š

1. âœ… **ä¿®å¤æ™ºèƒ½æœç´¢**ï¼šä»æ—§æ•°æ®æ¨¡å‹è¿ç§»åˆ°æ–°æ¶æ„
2. âœ… **è§£å†³ç¼–è¯‘é”™è¯¯**ï¼šæ·»åŠ å¿…è¦çš„å¯¼å…¥å’Œç¯å¢ƒå¯¹è±¡
3. âœ… **åˆ›å»ºè¿½è¸ªè§†å›¾**ï¼šå®ç°åŒè§†è§’å®æ—¶ä½ç½®æ˜¾ç¤º
4. âœ… **æ”¹è¿›ç”¨æˆ·ä½“éªŒ**ï¼šæœç´¢ç»“æœç›´æ¥æ˜¾ç¤ºï¼Œæ— éœ€è·³è½¬
5. âœ… **æ·»åŠ è°ƒè¯•æ”¯æŒ**ï¼šæ—¥å¿—è¾“å‡ºå¸®åŠ©æ’æŸ¥é—®é¢˜

ç°åœ¨ä½ çš„æ™ºèƒ½æœç´¢åŠŸèƒ½åº”è¯¥å®Œå…¨æ­£å¸¸å·¥ä½œäº†ï¼ğŸ‰

---

**æœ€åæ›´æ–°ï¼š** 2025-12-07  
**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0
